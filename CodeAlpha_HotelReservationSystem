import java.io.*;
import java.util.*;

class Room {
    int roomNumber;
    String category;
    double price;
    boolean isAvailable;

    Room(int roomNumber, String category, double price) {
        this.roomNumber = roomNumber;
        this.category = category;
        this.price = price;
        this.isAvailable = true;
    }
}

class Booking {
    String customerName;
    int roomNumber;
    String category;
    double amountPaid;

    Booking(String customerName, int roomNumber, String category, double amountPaid) {
        this.customerName = customerName;
        this.roomNumber = roomNumber;
        this.category = category;
        this.amountPaid = amountPaid;
    }

    @Override
    public String toString() {
        return customerName + "," + roomNumber + "," + category + "," + amountPaid;
    }
}

public class HotelReservationSystem {

    static ArrayList<Room> rooms = new ArrayList<>();
    static final String FILE_NAME = "bookings.txt";

    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);
        initializeRooms();
        loadBookings();

        while (true) {
            System.out.println("\n====== HOTEL RESERVATION SYSTEM ======");
            System.out.println("1. Search Available Rooms");
            System.out.println("2. Book Room");
            System.out.println("3. Cancel Booking");
            System.out.println("4. View Bookings");
            System.out.println("5. Exit");
            System.out.print("Enter choice: ");

            int choice = sc.nextInt();
            sc.nextLine();

            switch (choice) {
                case 1 -> searchRooms();
                case 2 -> bookRoom(sc);
                case 3 -> cancelBooking(sc);
                case 4 -> viewBookings();
                case 5 -> {
                    System.out.println("Thank you! Exiting...");
                    return;
                }
                default -> System.out.println("Invalid choice!");
            }
        }
    }

    static void initializeRooms() {
        rooms.add(new Room(101, "Standard", 2000));
        rooms.add(new Room(102, "Standard", 2000));
        rooms.add(new Room(201, "Deluxe", 3500));
        rooms.add(new Room(202, "Deluxe", 3500));
        rooms.add(new Room(301, "Suite", 5000));
    }

    static void searchRooms() {
        System.out.println("\nAvailable Rooms:");
        for (Room r : rooms) {
            if (r.isAvailable) {
                System.out.println("Room No: " + r.roomNumber +
                        " | Category: " + r.category +
                        " | Price: ₹" + r.price);
            }
        }
    }

    static void bookRoom(Scanner sc) {
        System.out.print("Enter your name: ");
        String name = sc.nextLine();

        searchRooms();

        System.out.print("Enter room number to book: ");
        int roomNo = sc.nextInt();

        for (Room r : rooms) {
            if (r.roomNumber == roomNo && r.isAvailable) {
                System.out.println("Amount to pay: ₹" + r.price);
                System.out.print("Confirm payment (yes/no): ");
                sc.nextLine();
                String pay = sc.nextLine();

                if (pay.equalsIgnoreCase("yes")) {
                    r.isAvailable = false;
                    saveBooking(new Booking(name, r.roomNumber, r.category, r.price));
                    System.out.println("Booking successful!");
                } else {
                    System.out.println("Payment cancelled.");
                }
                return;
            }
        }
        System.out.println("Room not available.");
    }

    static void cancelBooking(Scanner sc) {
        System.out.print("Enter room number to cancel booking: ");
        int roomNo = sc.nextInt();

        File inputFile = new File(FILE_NAME);
        File tempFile = new File("temp.txt");

        boolean found = false;

        try (BufferedReader br = new BufferedReader(new FileReader(inputFile));
             PrintWriter pw = new PrintWriter(new FileWriter(tempFile))) {

            String line;
            while ((line = br.readLine()) != null) {
                String[] data = line.split(",");
                int bookedRoom = Integer.parseInt(data[1]);

                if (bookedRoom == roomNo) {
                    found = true;
                    for (Room r : rooms) {
                        if (r.roomNumber == roomNo) {
                            r.isAvailable = true;
                        }
                    }
                } else {
                    pw.println(line);
                }
            }
        } catch (IOException e) {
            System.out.println("Error handling file.");
        }

        inputFile.delete();
        tempFile.renameTo(inputFile);

        if (found)
            System.out.println("Booking cancelled successfully.");
        else
            System.out.println("No booking found.");
    }

    static void viewBookings() {
        System.out.println("\nCurrent Bookings:");
        try (BufferedReader br = new BufferedReader(new FileReader(FILE_NAME))) {
            String line;
            while ((line = br.readLine()) != null) {
                String[] b = line.split(",");
                System.out.println("Name: " + b[0] +
                        " | Room: " + b[1] +
                        " | Category: " + b[2] +
                        " | Paid: ₹" + b[3]);
            }
        } catch (IOException e) {
            System.out.println("No bookings yet.");
        }
    }

    static void saveBooking(Booking booking) {
        try (FileWriter fw = new FileWriter(FILE_NAME, true)) {
            fw.write(booking.toString() + "\n");
        } catch (IOException e) {
            System.out.println("Error saving booking.");
        }
    }

    static void loadBookings() {
        try (BufferedReader br = new BufferedReader(new FileReader(FILE_NAME))) {
            String line;
            while ((line = br.readLine()) != null) {
                int roomNo = Integer.parseInt(line.split(",")[1]);
                for (Room r : rooms) {
                    if (r.roomNumber == roomNo) {
                        r.isAvailable = false;
                    }
                }
            }
        } catch (IOException ignored) {}
    }
}
